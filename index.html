<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>AquaAlert - Global Flood Risk Detection</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<meta name="theme-color" content="#0284c7">
<meta name="description" content="Real-time flood risk detection worldwide with live weather data">
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f7fa;
    color: #2c3e50;
    -webkit-user-select: none;
    user-select: none;
  }

  header {
    background: white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    position: sticky;
    top: 0;
    z-index: 1000;
  }

  .navbar {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 30px;
  }

  .logo {
    font-size: 1.8rem;
    font-weight: 800;
    background: linear-gradient(135deg, #0284c7 0%, #06b6d4 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .nav-links {
    display: flex;
    gap: 30px;
    list-style: none;
  }

  .nav-links a {
    text-decoration: none;
    color: #2c3e50;
    font-weight: 600;
    font-size: 0.95rem;
    transition: color 0.3s ease;
    position: relative;
  }

  .nav-links a::after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 0;
    width: 0;
    height: 3px;
    background: #0284c7;
    transition: width 0.3s ease;
  }

  .nav-links a:hover {
    color: #0284c7;
  }

  .nav-links a:hover::after {
    width: 100%;
  }

  .alert-badge {
    background: #ff2d55;
    color: white;
    padding: 8px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 700;
    animation: pulse-badge 2s ease-in-out infinite;
  }

  @keyframes pulse-badge {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }

  .hero {
    background: linear-gradient(135deg, #0284c7 0%, #06b6d4 50%, #00d9ff 100%);
    color: white;
    padding: 80px 30px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .hero h1 {
    font-size: 3.5rem;
    margin-bottom: 20px;
    font-weight: 900;
    letter-spacing: -1px;
  }

  .hero p {
    font-size: 1.3rem;
    margin-bottom: 30px;
    opacity: 0.95;
  }

  .hero-buttons {
    display: flex;
    gap: 20px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .btn-primary {
    background: white;
    color: #0284c7;
    padding: 15px 40px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 700;
    font-size: 1rem;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  }

  .btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
  }

  .btn-secondary {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: 2px solid white;
    padding: 15px 40px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 700;
    font-size: 1rem;
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .btn-secondary:hover {
    background: white;
    color: #0284c7;
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 60px 30px;
  }

  .section-title {
    font-size: 2.8rem;
    font-weight: 800;
    margin-bottom: 15px;
    color: #1a202c;
  }

  .section-subtitle {
    font-size: 1.1rem;
    color: #718096;
    margin-bottom: 40px;
  }

  .monitor-section {
    background: white;
    padding: 50px;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
    margin-bottom: 40px;
  }

  .monitor-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid #e2e8f0;
  }

  .monitor-header h2 {
    font-size: 2rem;
    color: #1a202c;
  }

  .status-indicator {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 20px;
    background: #f7fafc;
    border-radius: 8px;
    font-weight: 600;
  }

  .status-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    animation: pulse-dot 2s ease-in-out infinite;
  }

  .status-dot.low { background: #10b981; }
  .status-dot.moderate { background: #f59e0b; }
  .status-dot.high { background: #ef4444; }

  @keyframes pulse-dot {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.6; transform: scale(1.2); }
  }

  .location-section {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 40px;
  }

  .location-card {
    background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
    padding: 30px;
    border-radius: 12px;
    border: 2px solid #e2e8f0;
  }

  .location-card h3 {
    color: #1a202c;
    font-size: 1.2rem;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .location-card input {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #cbd5e0;
    border-radius: 8px;
    font-size: 1rem;
    margin-bottom: 15px;
    transition: border-color 0.3s ease;
  }

  .location-card input:focus {
    outline: none;
    border-color: #0284c7;
  }

  .button-group {
    display: flex;
    gap: 10px;
  }

  .btn-location, .btn-search {
    flex: 1;
    color: white;
    padding: 14px;
    border: none;
    border-radius: 8px;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .btn-location {
    background: linear-gradient(135deg, #0284c7 0%, #06b6d4 100%);
  }

  .btn-search {
    background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
  }

  .btn-location:hover:not(:disabled), .btn-search:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  }

  .btn-location:disabled, .btn-search:disabled {
    opacity: 0.7;
    cursor: not-allowed;
  }

  .suggestions-box {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    max-height: 300px;
    overflow-y: auto;
    margin-top: 10px;
    display: none;
    z-index: 100;
    position: absolute;
    width: calc(100% - 60px);
  }

  .suggestion-item {
    padding: 10px 15px;
    cursor: pointer;
    border-bottom: 1px solid #e2e8f0;
    transition: background 0.2s ease;
  }

  .suggestion-item:hover {
    background: #f7fafc;
    color: #0284c7;
  }

  .risk-display {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    padding: 40px;
    border-radius: 12px;
    border: 2px solid #e2e8f0;
  }

  .risk-percentage {
    font-size: 5rem;
    font-weight: 900;
    text-align: center;
    margin: 20px 0;
    line-height: 1;
  }

  .risk-percentage.low { color: #10b981; }
  .risk-percentage.moderate { color: #f59e0b; }
  .risk-percentage.high { color: #ef4444; }

  .risk-status {
    text-align: center;
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 20px;
  }

  .location-info {
    text-align: center;
    font-size: 0.95rem;
    color: #718096;
    margin-bottom: 20px;
    padding: 15px;
    background: #f7fafc;
    border-radius: 8px;
  }

  .location-info strong {
    color: #1a202c;
  }

  .weather-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 40px 0;
  }

  .weather-card {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 25px;
    text-align: center;
    transition: all 0.3s ease;
  }

  .weather-card:hover {
    border-color: #0284c7;
    box-shadow: 0 10px 30px rgba(2, 132, 199, 0.15);
    transform: translateY(-5px);
  }

  .weather-card .icon { font-size: 2.5rem; margin-bottom: 10px; }
  .weather-card .label { color: #718096; font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; }
  .weather-card .value { font-size: 2rem; font-weight: 800; color: #1a202c; margin-bottom: 5px; }
  .weather-card .unit { color: #a0aec0; font-size: 0.9rem; }

  .risk-factors { margin-top: 40px; }
  .risk-factor-item { margin-bottom: 25px; }
  .risk-factor-label { display: flex; justify-content: space-between; margin-bottom: 10px; font-weight: 600; }
  .risk-factor-label .name { color: #1a202c; }
  .risk-factor-label .percentage { color: #0284c7; font-weight: 700; }

  .progress-bar {
    width: 100%;
    height: 10px;
    background: #e2e8f0;
    border-radius: 10px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    border-radius: 10px;
    transition: width 1s ease;
  }

  .progress-rain { background: linear-gradient(90deg, #0284c7, #06b6d4); }
  .progress-water { background: linear-gradient(90deg, #0ea5e9, #0284c7); }
  .progress-historical { background: linear-gradient(90deg, #f59e0b, #d97706); }

  .alert-box {
    padding: 20px;
    border-radius: 12px;
    margin-top: 30px;
    display: none;
    font-weight: 700;
    font-size: 1.1rem;
  }

  .alert-box.low { background: #d1fae5; border-left: 5px solid #10b981; color: #065f46; }
  .alert-box.moderate { background: #fef3c7; border-left: 5px solid #f59e0b; color: #78350f; }
  .alert-box.high { background: #fee2e2; border-left: 5px solid #ef4444; color: #7f1d1d; }

  .error-message {
    background: #fee2e2;
    border-left: 5px solid #ef4444;
    color: #7f1d1d;
    padding: 15px;
    border-radius: 8px;
    margin-top: 15px;
    font-weight: 600;
    display: none;
  }

  .loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid #e2e8f0;
    border-top: 3px solid #0284c7;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .protocols-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
    margin-top: 40px;
  }

  .protocol-card {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 30px;
    transition: all 0.3s ease;
  }

  .protocol-card:hover {
    border-color: #0284c7;
    box-shadow: 0 15px 40px rgba(2, 132, 199, 0.1);
    transform: translateY(-8px);
  }

  .protocol-card h3 {
    color: #1a202c;
    font-size: 1.3rem;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .protocol-card ul {
    list-style: none;
  }

  .protocol-card li {
    color: #4a5568;
    margin-bottom: 10px;
    padding-left: 25px;
    position: relative;
    line-height: 1.6;
  }

  .protocol-card li::before {
    content: '✓';
    position: absolute;
    left: 0;
    color: #10b981;
    font-weight: 700;
  }

  .contacts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 40px;
  }

  .contact-card {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 25px;
    text-align: center;
    transition: all 0.3s ease;
  }

  .contact-card:hover {
    border-color: #0284c7;
    box-shadow: 0 10px 30px rgba(2, 132, 199, 0.15);
  }

  .contact-card .service-name { font-size: 1.1rem; font-weight: 700; color: #1a202c; margin-bottom: 10px; }
  .contact-card .number { font-size: 2.2rem; font-weight: 900; color: #0284c7; margin-bottom: 10px; }

  footer {
    background: #1a202c;
    color: white;
    padding: 50px 30px;
    text-align: center;
  }

  .footer-content { max-width: 1400px; margin: 0 auto; }
  .footer-links { display: flex; justify-content: center; gap: 30px; margin-bottom: 20px; flex-wrap: wrap; }
  .footer-links a { color: #cbd5e0; text-decoration: none; transition: color 0.3s ease; }
  .footer-links a:hover { color: #0284c7; }

  .world-map { text-align: center; margin: 30px 0; }
  .world-map img { max-width: 100%; height: auto; border-radius: 12px; }

  @media (max-width: 768px) {
    .hero h1 { font-size: 2.5rem; }
    .location-section { grid-template-columns: 1fr; }
    .monitor-section { padding: 30px; }
    .risk-percentage { font-size: 3.5rem; }
    .nav-links { gap: 15px; }
  }
</style>
</head>
<body>

<header>
  <div class="navbar">
    <div class="logo">
      <i class="fas fa-droplet"></i> AquaAlert
    </div>
    <ul class="nav-links">
      <li><a href="#monitor">Monitor</a></li>
      <li><a href="#protocols">Safety</a></li>
      <li><a href="#contacts">Contacts</a></li>
      <li><span class="alert-badge"><i class="fas fa-exclamation-circle"></i> LIVE</span></li>
    </ul>
  </div>
</header>

<section class="hero">
  <div style="position: relative; z-index: 2;">
    <h1>🌊 AquaAlert</h1>
    <p>Real-time flood risk detection for any location worldwide</p>
    <div class="hero-buttons">
      <button class="btn-primary" onclick="document.getElementById('monitor').scrollIntoView({behavior: 'smooth'})">Check Risk Now</button>
      <button class="btn-secondary" onclick="document.getElementById('contacts').scrollIntoView({behavior: 'smooth'})">Emergency Contacts</button>
    </div>
  </div>
</section>

<div class="container">

  <section id="monitor" class="monitor-section">
    <div class="monitor-header">
      <h2><i class="fas fa-water"></i> Global Flood Risk Monitor</h2>
      <div class="status-indicator">
        <div class="status-dot low" id="status-dot"></div>
        <span id="status-text">Ready</span>
      </div>
    </div>

    <div class="location-section">
      <div class="location-card" style="position: relative;">
        <h3><i class="fas fa-map-marker-alt"></i> GPS Detection</h3>
        <p style="font-size: 0.9rem; color: #718096; margin-bottom: 15px;">Use your device GPS for exact location</p>
        <button class="btn-location" onclick="getCurrentLocation()">
          <i class="fas fa-location-arrow"></i> Get My Location
        </button>
      </div>
      <div class="location-card" style="position: relative;">
        <h3><i class="fas fa-search-location"></i> Search Worldwide</h3>
        <input type="text" id="search-location" placeholder="Search any city worldwide..." onkeyup="showSuggestions(this.value)" />
        <div class="suggestions-box" id="suggestions"></div>
        <button class="btn-search" onclick="searchLocation()">
          <i class="fas fa-search"></i> Search
        </button>
      </div>
    </div>

    <div id="location_output" class="location-info" style="display: none;">
      <strong>📍 Location:</strong> <span id="location-name">--</span><br>
      <strong>🌍 Country:</strong> <span id="location-country">--</span><br>
      <strong>🧭 Coordinates:</strong> <span id="location-coords">--</span>
    </div>

    <div id="error-msg" class="error-message"></div>

    <div class="risk-display">
      <div class="risk-percentage" id="risk_percentage">--%</div>
      <div class="risk-status" id="risk_status">Select a location to check flood risk</div>

      <div class="weather-grid">
        <div class="weather-card">
          <div class="icon">💧</div>
          <div class="label">Precipitation</div>
          <div class="value" id="precip">--</div>
          <div class="unit">mm</div>
        </div>
        <div class="weather-card">
          <div class="icon">💨</div>
          <div class="label">Humidity</div>
          <div class="value" id="humidity">--</div>
          <div class="unit">%</div>
        </div>
        <div class="weather-card">
          <div class="icon">🌡️</div>
          <div class="label">Temperature</div>
          <div class="value" id="temp">--</div>
          <div class="unit">°C</div>
        </div>
        <div class="weather-card">
          <div class="icon">🌪️</div>
          <div class="label">Wind Speed</div>
          <div class="value" id="wind">--</div>
          <div class="unit">m/s</div>
        </div>
      </div>

      <div class="risk-factors">
        <div class="risk-factor-item">
          <div class="risk-factor-label">
            <span class="name">Rainfall Intensity</span>
            <span class="percentage" id="rainfall-percent">0%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill progress-rain" id="rainfall-progress" style="width: 0%;"></div>
          </div>
        </div>

        <div class="risk-factor-item">
          <div class="risk-factor-label">
            <span class="name">Water Level Risk</span>
            <span class="percentage" id="water-percent">0%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill progress-water" id="water-level-progress" style="width: 0%;"></div>
          </div>
        </div>

        <div class="risk-factor-item">
          <div class="risk-factor-label">
            <span class="name">Overall Risk Factor</span>
            <span class="percentage" id="historical-percent">0%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill progress-historical" id="historical-progress" style="width: 0%;"></div>
          </div>
        </div>
      </div>

      <div class="alert-box" id="alert"></div>
    </div>
  </section>

  <section id="protocols">
    <h2 class="section-title"><i class="fas fa-shield-alt"></i> Universal Safety Protocols</h2>
    <p class="section-subtitle">Life-saving guidelines for all regions worldwide</p>

    <div class="protocols-grid">
      <div class="protocol-card">
        <h3><span style="font-size: 1.8rem;">🔔</span> Before Disaster</h3>
        <ul>
          <li>Emergency kit: food, water, medications</li>
          <li>Know evacuation routes</li>
          <li>Monitor local weather alerts</li>
          <li>Secure important documents</li>
          <li>Communicate family plan</li>
        </ul>
      </div>

      <div class="protocol-card">
        <h3><span style="font-size: 1.8rem;">⚡</span> During Disaster</h3>
        <ul>
          <li>Follow evacuation orders immediately</li>
          <li>Never use flooded roads</li>
          <li>Stay connected with family</li>
          <li>Seek higher ground</li>
          <li>Listen to emergency broadcasts</li>
        </ul>
      </div>

      <div class="protocol-card">
        <h3><span style="font-size: 1.8rem;">✓</span> After Disaster</h3>
        <ul>
          <li>Check for injuries</li>
          <li>Document all damages</li>
          <li>Boil drinking water</li>
          <li>Avoid hazards</li>
          <li>Support community recovery</li>
        </ul>
      </div>
    </div>
  </section>

  <section id="contacts">
    <h2 class="section-title"><i class="fas fa-phone"></i> Global Emergency Contacts</h2>
    <p class="section-subtitle">Important numbers by region (please verify with local authorities)</p>

    <div class="contacts-grid">
      <div class="contact-card">
        <div class="service-name">🌍 India</div>
        <div class="number">112</div>
        <p style="font-size: 0.9rem; color: #718096;">Police, Fire, Ambulance</p>
      </div>
      <div class="contact-card">
        <div class="service-name">🇺🇸 USA</div>
        <div class="number">911</div>
        <p style="font-size: 0.9rem; color: #718096;">Emergency Services</p>
      </div>
      <div class="contact-card">
        <div class="service-name">🇬🇧 UK</div>
        <div class="number">999</div>
        <p style="font-size: 0.9rem; color: #718096;">Police, Fire, Ambulance</p>
      </div>
      <div class="contact-card">
        <div class="service-name">🇪🇺 Europe</div>
        <div class="number">112</div>
        <p style="font-size: 0.9rem; color: #718096;">Universal Emergency</p>
      </div>
      <div class="contact-card">
        <div class="service-name">🇦🇺 Australia</div>
        <div class="number">000</div>
        <p style="font-size: 0.9rem; color: #718096;">Emergency Services</p>
      </div>
      <div class="contact-card">
        <div class="service-name">🇯🇵 Japan</div>
        <div class="number">110</div>
        <p style="font-size: 0.9rem; color: #718096;">Police & Emergency</p>
      </div>
    </div>
  </section>

</div>

<footer>
  <div class="footer-content">
    <p style="margin-bottom: 15px;">© 2025 AquaAlert - Your Worldwide Flood Risk Alert System</p>
    <div class="footer-links">
      <a href="#monitor">Monitor</a>
      <a href="#protocols">Safety</a>
      <a href="#contacts">Contacts</a>
      <a href="#">About</a>
      <a href="#">Privacy</a>
    </div>
    <small>Using Open-Meteo Weather API | Works in 195+ Countries | Real-time Data</small>
  </div>
</footer>

<script>
  // Massive database of world cities
  const WORLD_CITIES = [
    // India
    {name: 'Hyderabad, India', lat: 17.3850, lon: 78.4867, country: 'India'},
    {name: 'Mumbai, India', lat: 19.0760, lon: 72.8777, country: 'India'},
    {name: 'Delhi, India', lat: 28.7041, lon: 77.1025, country: 'India'},
    {name: 'Bangalore, India', lat: 12.9716, lon: 77.5946, country: 'India'},
    {name: 'Chennai, India', lat: 13.0827, lon: 80.2707, country: 'India'},
    {name: 'Kolkata, India', lat: 22.5726, lon: 88.3639, country: 'India'},
    {name: 'Pune, India', lat: 18.5204, lon: 73.8567, country: 'India'},
    {name: 'Ahmedabad, India', lat: 23.0225, lon: 72.5714, country: 'India'},
    {name: 'Jaipur, India', lat: 26.9124, lon: 75.7873, country: 'India'},
    {name: 'Lucknow, India', lat: 26.8467, lon: 80.9462, country: 'India'},
    {name: 'Chandigarh, India', lat: 30.7333, lon: 76.7794, country: 'India'},
    {name: 'Surat, India', lat: 21.1707, lon: 72.8311, country: 'India'},
    // USA
    {name: 'New York, USA', lat: 40.7128, lon: -74.0060, country: 'USA'},
    {name: 'Los Angeles, USA', lat: 34.0522, lon: -118.2437, country: 'USA'},
    {name: 'Chicago, USA', lat: 41.8781, lon: -87.6298, country: 'USA'},
    {name: 'Houston, USA', lat: 29.7604, lon: -95.3698, country: 'USA'},
    {name: 'Phoenix, USA', lat: 33.4484, lon: -112.0742, country: 'USA'},
    {name: 'Miami, USA', lat: 25.7617, lon: -80.1918, country: 'USA'},
    {name: 'Seattle, USA', lat: 47.6062, lon: -122.3321, country: 'USA'},
    {name: 'San Francisco, USA', lat: 37.7749, lon: -122.4194, country: 'USA'},
    // Europe
    {name: 'London, UK', lat: 51.5074, lon: -0.1278, country: 'UK'},
    {name: 'Paris, France', lat: 48.8566, lon: 2.3522, country: 'France'},
    {name: 'Berlin, Germany', lat: 52.5200, lon: 13.4050, country: 'Germany'},
    {name: 'Madrid, Spain', lat: 40.4168, lon: -3.7038, country: 'Spain'},
    {name: 'Rome, Italy', lat: 41.9028, lon: 12.4964, country: 'Italy'},
    {name: 'Amsterdam, Netherlands', lat: 52.3676, lon: 4.9041, country: 'Netherlands'},
    {name: 'Brussels, Belgium', lat: 50.8503, lon: 4.3517, country: 'Belgium'},
    {name: 'Vienna, Austria', lat: 48.2082, lon: 16.3738, country: 'Austria'},
    {name: 'Prague, Czech Republic', lat: 50.0755, lon: 14.4378, country: 'Czech Republic'},
    // Asia
    {name: 'Tokyo, Japan', lat: 35.6762, lon: 139.6503, country: 'Japan'},
    {name: 'Singapore, Singapore', lat: 1.3521, lon: 103.8198, country: 'Singapore'},
    {name: 'Bangkok, Thailand', lat: 13.7563, lon: 100.5018, country: 'Thailand'},
    {name: 'Hong Kong, Hong Kong', lat: 22.3193, lon: 114.1694, country: 'Hong Kong'},
    {name: 'Shanghai, China', lat: 31.2304, lon: 121.4737, country: 'China'},
    {name: 'Beijing, China', lat: 39.9042, lon: 116.4074, country: 'China'},
    {name: 'Manila, Philippines', lat: 14.5995, lon: 120.9842, country: 'Philippines'},
    {name: 'Hanoi, Vietnam', lat: 21.0285, lon: 105.8542, country: 'Vietnam'},
    {name: 'Seoul, South Korea', lat: 37.5665, lon: 126.9780, country: 'South Korea'},
    {name: 'Dubai, UAE', lat: 25.2048, lon: 55.2708, country: 'UAE'},
    {name: 'Istanbul, Turkey', lat: 41.0082, lon: 28.9784, country: 'Turkey'},
    // Americas
    {name: 'Toronto, Canada', lat: 43.6532, lon: -79.3832, country: 'Canada'},
    {name: 'Mexico City, Mexico', lat: 19.4326, lon: -99.1332, country: 'Mexico'},
    {name: 'São Paulo, Brazil', lat: -23.5505, lon: -46.6333, country: 'Brazil'},
    {name: 'Buenos Aires, Argentina', lat: -34.6037, lon: -58.3816, country: 'Argentina'},
    {name: 'Santiago, Chile', lat: -33.8688, lon: -51.2093, country: 'Chile'},
    // Africa
    {name: 'Cairo, Egypt', lat: 30.0444, lon: 31.2357, country: 'Egypt'},
    {name: 'Lagos, Nigeria', lat: 6.5244, lon: 3.3792, country: 'Nigeria'},
    {name: 'Cape Town, South Africa', lat: -33.9249, lon: 18.4241, country: 'South Africa'},
    {name: 'Nairobi, Kenya', lat: -1.2921, lon: 36.8219, country: 'Kenya'},
    // Oceania
    {name: 'Sydney, Australia', lat: -33.8688, lon: 151.2093, country: 'Australia'},
    {name: 'Melbourne, Australia', lat: -37.8136, lon: 144.9631, country: 'Australia'},
    {name: 'Auckland, New Zealand', lat: -37.0882, lon: 174.7645, country: 'New Zealand'}
  ];

  let state = {
    location: null,
    weatherData: null,
    floodRisk: 0,
    cityName: 'Unknown',
    country: 'Unknown'
  };

  function showSuggestions(value) {
    const box = document.getElementById('suggestions');
    if (!value || value.length < 2) {
      box.style.display = 'none';
      return;
    }

    const filtered = WORLD_CITIES.filter(c => 
      c.name.toLowerCase().includes(value.toLowerCase())
    ).slice(0, 10);

    if (filtered.length === 0) {
      box.style.display = 'none';
      return;
    }

    box.innerHTML = filtered.map(c => 
      `<div class="suggestion-item" onclick="selectCity('${c.name}', ${c.lat}, ${c.lon}, '${c.country}')">${c.name}</div>`
    ).join('');
    box.style.display = 'block';
  }

  async function selectCity(name, lat, lon, country) {
    document.getElementById('search-location').value = name;
    document.getElementById('suggestions').style.display = 'none';
    state.location = { latitude: lat, longitude: lon };
    state.cityName = name.split(',')[0];
    state.country = country;
    updateLocationDisplay();
    await fetchWeather(lat, lon);
  }

  function getCurrentLocation() {
    const btn = event.target;
    btn.disabled = true;
    btn.innerHTML = '<span class="loading"></span> Detecting...';
    
    clearError();

    if (!navigator.geolocation) {
      showError('GPS not available on your device');
      btn.disabled = false;
      btn.innerHTML = '<i class="fas fa-location-arrow"></i> Get My Location';
      return;
    }

    navigator.geolocation.getCurrentPosition(
      async (position) => {
        const { latitude, longitude } = position.coords;
        state.location = { latitude, longitude };
        await getCityName(latitude, longitude);
        await fetchWeather(latitude, longitude);
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-location-arrow"></i> Get My Location';
      },
      (error) => {
        showError('GPS Error: ' + error.message);
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-location-arrow"></i> Get My Location';
      },
      { enableHighAccuracy: true, timeout: 10000 }
    );
  }

  async function searchLocation() {
    const input = document.getElementById('search-location').value.trim();
    if (!input) {
      showError('Please enter a city name or coordinates');
      return;
    }

    const btn = event.target;
    btn.disabled = true;
    btn.innerHTML = '<span class="loading"></span> Searching...';
    
    clearError();

    const coordRegex = /^(-?\d+\.?\d*),\s*(-?\d+\.?\d*)$/;
    const match = input.match(coordRegex);

    if (match) {
      const lat = parseFloat(match[1]);
      const lon = parseFloat(match[2]);
      
      if (lat < -90 || lat > 90 || lon < -180 || lon > 180) {
        showError('Invalid coordinates');
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-search"></i> Search';
        return;
      }

      state.location = { latitude: lat, longitude: lon };
      await getCityName(lat, lon);
      await fetchWeather(lat, lon);
    } else {
      const popular = WORLD_CITIES.find(c => c.name.toLowerCase() === input.toLowerCase());
      
      if (popular) {
        state.location = { latitude: popular.lat, longitude: popular.lon };
        state.cityName = popular.name.split(',')[0];
        state.country = popular.country;
        updateLocationDisplay();
        await fetchWeather(popular.lat, popular.lon);
      } else {
        try {
          const res = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(input)}&count=1&language=en&format=json`);
          const data = await res.json();

          if (data.results && data.results.length > 0) {
            const result = data.results[0];
            state.location = { latitude: result.latitude, longitude: result.longitude };
            state.cityName = result.name;
            state.country = result.country;
            updateLocationDisplay();
            await fetchWeather(result.latitude, result.longitude);
          } else {
            showError('City not found worldwide. Try a different search.');
          }
        } catch (e) {
          showError('Search failed. Try another location.');
        }
      }
    }

    btn.disabled = false;
    btn.innerHTML = '<i class="fas fa-search"></i> Search';
  }

  async function getCityName(lat, lon) {
    try {
      const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
      const data = await res.json();
      
      if (data.address) {
        const city = data.address.city || data.address.town || data.address.village || 'Location';
        state.cityName = city;
        state.country = data.address.country || 'Unknown';
      }
    } catch (e) {
      console.log('Geocoding failed');
    }
    updateLocationDisplay();
  }

  function updateLocationDisplay() {
    const output = document.getElementById('location_output');
    if (state.location) {
      output.style.display = 'block';
      document.getElementById('location-name').innerText = state.cityName;
      document.getElementById('location-country').innerText = state.country;
      document.getElementById('location-coords').innerText = `${state.location.latitude.toFixed(4)}, ${state.location.longitude.toFixed(4)}`;
    }
  }

  async function fetchWeather(lat, lon) {
    try {
      const res = await fetch(
        `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,precipitation,weather_code,wind_speed_10m&timezone=auto`
      );
      const data = await res.json();
      
      if (data && data.current) {
        state.weatherData = {
          precipitation: data.current.precipitation || 0,
          humidity: data.current.relative_humidity_2m || 0,
          temperature: data.current.temperature_2m || 0,
          windSpeed: data.current.wind_speed_10m || 0
        };
        displayWeather();
        calculateFloodRisk();
      } else {
        showError('Failed to get weather data');
      }
    } catch (e) {
      showError('Weather API error');
    }
  }

  function displayWeather() {
    const w = state.weatherData || {};
    document.getElementById('precip').innerText = w.precipitation ? w.precipitation.toFixed(1) : '0';
    document.getElementById('humidity').innerText = w.humidity || '--';
    document.getElementById('temp').innerText = w.temperature ? w.temperature.toFixed(1) : '--';
    document.getElementById('wind').innerText = w.windSpeed ? w.windSpeed.toFixed(1) : '--';
  }

  function calculateFloodRisk() {
    const w = state.weatherData;
    if (!w) return;
    
    let risk = 0;
    if (w.precipitation >= 30) risk += 40;
    else if (w.precipitation >= 15) risk += 25;
    if (w.humidity >= 85) risk += 30;
    else if (w.humidity >= 70) risk += 15;
    if (w.windSpeed > 10) risk += 15;
    if (w.temperature < 5) risk += 10;
    risk = Math.min(risk, 100);
    state.floodRisk = risk;

    updateDisplay(risk);
    updateProgressBars();
  }

  function updateDisplay(risk) {
    const riskEl = document.getElementById('risk_percentage');
    const statusEl = document.getElementById('risk_status');
    const statusDot = document.getElementById('status-dot');
    const statusText = document.getElementById('status-text');
    const alert = document.querySelector('.alert-box');

    riskEl.innerText = risk + '%';
    riskEl.className = '';
    
    if (risk < 35) {
      riskEl.classList.add('low');
      statusEl.innerText = '✓ LOW RISK';
      statusDot.className = 'status-dot low';
      statusText.innerText = 'SAFE';
      alert.className = 'alert-box low';
      alert.innerHTML = '<i class="fas fa-check-circle"></i> Good weather. No flood risk detected.';
    } else if (risk < 60) {
      riskEl.classList.add('moderate');
      statusEl.innerText = '⚠ MODERATE RISK';
      statusDot.className = 'status-dot moderate';
      statusText.innerText = 'ALERT';
      alert.className = 'alert-box moderate';
      alert.innerHTML = '<i class="fas fa-exclamation-circle"></i> Moderate flood risk detected. Monitor weather updates closely.';
    } else {
      riskEl.classList.add('high');
      statusEl.innerText = '🚨 HIGH RISK';
      statusDot.className = 'status-dot high';
      statusText.innerText = 'DANGER';
      alert.className = 'alert-box high';
      alert.innerHTML = '<i class="fas fa-exclamation-triangle"></i> HIGH FLOOD RISK! Prepare to evacuate immediately. Follow official guidance.';
    }
    alert.style.display = 'block';
  }

  function updateProgressBars() {
    const w = state.weatherData;
    const rainPercent = Math.min((w.precipitation / 30) * 100, 100);
    const waterPercent = Math.min((w.precipitation / 15) * 50, 100);
    const histPercent = state.floodRisk * 0.6;

    document.getElementById('rainfall-progress').style.width = rainPercent + '%';
    document.getElementById('water-level-progress').style.width = waterPercent + '%';
    document.getElementById('historical-progress').style.width = histPercent + '%';

    document.getElementById('rainfall-percent').innerText = Math.round(rainPercent) + '%';
    document.getElementById('water-percent').innerText = Math.round(waterPercent) + '%';
    document.getElementById('historical-percent').innerText = Math.round(histPercent) + '%';
  }

  function showError(msg) {
    const errorEl = document.getElementById('error-msg');
    errorEl.innerHTML = '❌ ' + msg;
    errorEl.style.display = 'block';
  }

  function clearError() {
    document.getElementById('error-msg').style.display = 'none';
  }

  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('search-location').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') searchLocation();
    });
  });
</script>

</body>
</html>
